(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".activity[data-v-1c6de4f7]{display:flex;flex-direction:column;overflow:hidden;height:100%}.activity__actions[data-v-1c6de4f7]{display:flex;flex-direction:column;width:100%}.activity__list[data-v-1c6de4f7]{flex-grow:1;overflow:scroll}.activity__empty-content[data-v-1c6de4f7]{height:100%}[data-v-1c6de4f7] .empty-content__icon span{background-size:64px;width:64px;height:64px}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
import{l}from"./activity-sidebar.mjs";import{c,f as u,N as f,g as v,v as p}from"./NcCheckboxRadioSwitch-Di9rSADK-BE-awEJQ.chunk.mjs";import{d,r as y,o as g,g as m,f as h,t as n}from"./vue.runtime.esm-Dapm8HaU.chunk.mjs";import{N as _,A as b,a as A}from"./ActivityComponent-DgWMwHeM.chunk.mjs";import{g as I,a as C,b as o}from"./api-CyyF6H6f.chunk.mjs";import{l as r}from"./logger-MOjl5B61.chunk.mjs";import"./preload-helper-Dh9HmuEY.chunk.mjs";import"./_commonjsHelpers-Cqwegr3R.chunk.mjs";const S=d({__name:"ActivitySidebarPlugin",props:{plugin:null,fileInfo:null},emits:["reload-activities"],setup(t,{emit:i}){const s=t,a=y();return g(()=>s.plugin.mount(a.value,{context:m()?.proxy,fileInfo:s.fileInfo,reload:()=>i("reload-activities")})),h(()=>s.plugin.unmount()),{__sfc:!0,props:s,emit:i,attachTarget:a}}});var N=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("div",{ref:"attachTarget"})},P=[],x=c(S,N,P,!1,null,null);const w=x.exports,k={name:"ActivityTab",components:{ActivityComponent:b,NcEmptyContent:_,NcIconSvgWrapper:f,NcLoadingIcon:u,ActivitySidebarPlugin:w},data(){return{error:"",loading:!0,fileInfo:null,activities:[],lightningBoltSVG:l,sidebarPlugins:[]}},mounted(){this.sidebarPlugins=o()},methods:{async update(t){this.sidebarPlugins=[];const i=o();i.length>0&&this.$nextTick(()=>{this.sidebarPlugins=i}),this.fileInfo=t,this.resetState(),await this.getActivities()},async getActivities(){try{this.loading=!0;const t=await this.processActivities(await this.loadRealActivities()),i=await C({fileInfo:this.fileInfo});this.activities=[...t,...i].sort((s,a)=>a.timestamp-s.timestamp)}catch(t){this.error=n("activity","Unable to load the activity list"),r.error("Error loading the activity list",{error:t})}finally{this.loading=!1}},resetState(){this.loading=!0,this.error="",this.activities=[]},async loadRealActivities(){try{const{data:t}=await v.get(p("apps/activity/api/v2/activity/filter"),{params:{format:"json",object_type:"files",object_id:this.fileInfo.id}});return t.ocs.data}catch(t){if(t.response!==void 0&&t.response.status===304)return[];throw e}},processActivities(t){t=t.map(s=>new A(s)),r.debug(`Processed ${t.length} activity(ies)`,{activities:t,fileInfo:this.fileInfo});const i=I();return t.filter(s=>!i||i.every(a=>a(s)))},t:n}};var E=function(){var t=this,i=t._self._c;return i("div",{staticClass:"activity",class:{"icon-loading":t.loading}},[t.error?i("NcEmptyContent",{attrs:{name:t.error},scopedSlots:t._u([{key:"icon",fn:function(){return[i("NcIconSvgWrapper",{attrs:{svg:t.lightningBoltSVG}})]},proxy:!0}],null,!1,63559581)}):[t.sidebarPlugins.length>0?i("div",{staticClass:"activity__actions"},t._l(t.sidebarPlugins,function(s,a){return i("ActivitySidebarPlugin",{key:a,attrs:{plugin:s,"file-info":t.fileInfo},on:{"reload-activities":function(L){return t.getActivities()}}})}),1):t._e(),t.loading?i("NcEmptyContent",{staticClass:"activity__empty-content",attrs:{name:t.t("activity","Loading activities")},scopedSlots:t._u([{key:"icon",fn:function(){return[i("NcLoadingIcon")]},proxy:!0}],null,!1,3085876643)}):t.activities.length===0?i("NcEmptyContent",{staticClass:"activity__empty-content",attrs:{name:t.t("activity","No activity yet")},scopedSlots:t._u([{key:"icon",fn:function(){return[i("span",{staticClass:"icon-activity"})]},proxy:!0}])}):i("ul",{staticClass:"activity__list"},t._l(t.activities,function(s){return i("ActivityComponent",{key:s.id,attrs:{activity:s,"show-previews":!1},on:{reload:function(a){return t.getActivities()}}})}),1)]],2)},T=[],j=c(k,E,T,!1,null,"1c6de4f7");const q=j.exports;export{q as default};
//# sourceMappingURL=ActivityTab-CB0Sjn9-.chunk.mjs.map
