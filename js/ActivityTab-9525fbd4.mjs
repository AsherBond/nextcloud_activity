(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode("[data-v-8b6a3c7b] .empty-content__icon span{background-size:64px;width:64px;height:64px}.activity__actions[data-v-8b6a3c7b]{display:flex;flex-direction:column;width:100%}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{f as r,n as d,d as g,c as f}from"./logger-63c76e96.mjs";import{d as p,r as v,o as h,i as y,j as m,g as b,t as l}from"./index-f8c3d93b.mjs";import{A,h as w,v as S,i as _}from"./Activity-be31e018.mjs";import{l as P}from"./activity-sidebar.mjs";class n{static pluginName="OCA.Activity.SidebarPlugin";#i=[];#t=[];#e=[];constructor(){window.OC.Plugins.attach(n.pluginName,this)}destroy(){window.OC.Plugins.detach(n.pluginName,this),this.#i=[],this.#t=[],this.#e=[]}reload(){this.destroy(),window.OC.Plugins.attach(n.pluginName,this)}registerSidebarAction(i){this.#i.push(i),r.debug("Registered new sidebar action")}registerSidebarEntries(i){this.#t.push(i),r.debug("Registered new sidebar entry factory")}registerSidebarFilter(i){this.#e.push(i),r.debug("Registered new sidebar filter")}getSidebarActions(){return this.#i??[]}async getAdditionalEntries(i){if(this.#t===void 0)return[];const e=this.#t.map(async s=>await s(i));return(await Promise.all(e)).flat()}getActivityFilters(){return this.#e??[]}}let a,u=0;const o=()=>{const t=window.OC.Plugins.getPlugins(n.pluginName).length;return a?u!==t&&a.reload():a=new n,u=t,a},I=p({__name:"ActivitySidebarPlugin",props:{plugin:null,fileInfo:null},emits:["reload-activities"],setup(t,{emit:i}){const e=t,s=v();return h(()=>e.plugin.mount(s.value,{context:y()?.proxy,fileInfo:e.fileInfo,reload:()=>i("reload-activities")})),m(()=>e.plugin.unmount()),{__sfc:!0,props:e,emit:i,attachTarget:s}}});var N=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("div",{ref:"attachTarget"})},C=[],x=d(I,N,C,!1,null,null,null,null);const E=x.exports;const k={name:"ActivityTab",components:{Activity:A,NcEmptyContent:w,NcIconSvgWrapper:S,NcLoadingIcon:g,ActivitySidebarPlugin:E},data(){return{error:"",loading:!0,fileInfo:null,activities:[],lightningBoltSVG:P,sidebarPlugins:[]}},mounted(){this.sidebarPlugins=o().getSidebarActions()},methods:{async update(t){this.fileInfo=t,this.resetState(),await this.getActivities()},async getActivities(){try{this.loading=!0;const t=this.processActivities(await f.get(b("apps/activity/api/v2/activity/filter"),{params:{format:"json",object_type:"files",object_id:this.fileInfo.id}})),i=await o().getAdditionalEntries({fileInfo:this.fileInfo});this.activities=[...t,...i].sort((e,s)=>s.timestamp-e.timestamp)}catch(t){if(t.response!==void 0&&t.response.status===304)return;this.error=l("activity","Unable to load the activity list"),console.error("Error loading the activity list",t)}finally{this.loading=!1}},resetState(){this.loading=!0,this.error="",this.activities=[]},processActivities({data:t}){if(t.ocs&&t.ocs.data&&t.ocs.data.length>0){const i=t.ocs.data.map(s=>new _(s));r.debug(`Processed ${i.length} activity(ies)`,{activities:i,fileInfo:this.fileInfo});const e=o().getActivityFilters();return i.filter(s=>!e||e.every(c=>c(s)))}},t:l}};var O=function(){var t=this,i=t._self._c;return i("div",{class:{"icon-loading":t.loading}},[t.error?i("NcEmptyContent",{attrs:{name:t.error},scopedSlots:t._u([{key:"icon",fn:function(){return[i("NcIconSvgWrapper",{attrs:{svg:t.lightningBoltSVG}})]},proxy:!0}],null,!1,63559581)}):[t.sidebarPlugins.length>0?i("div",{staticClass:"activity__actions"},t._l(t.sidebarPlugins,function(e,s){return i("ActivitySidebarPlugin",{key:s,attrs:{plugin:e,"file-info":t.fileInfo},on:{"reload-activities":function(c){return t.getActivities()}}})}),1):t._e(),t.loading?i("NcEmptyContent",{attrs:{name:t.t("activity","Loading activities")},scopedSlots:t._u([{key:"icon",fn:function(){return[i("NcLoadingIcon")]},proxy:!0}],null,!1,3085876643)}):t.activities.length===0?i("NcEmptyContent",{attrs:{name:t.t("activity","No activity yet")},scopedSlots:t._u([{key:"icon",fn:function(){return[i("span",{staticClass:"icon-activity"})]},proxy:!0}])}):i("ul",t._l(t.activities,function(e){return i("Activity",{key:e.id,attrs:{activity:e,"show-previews":!1},on:{reload:function(s){return t.getActivities()}}})}),1)]],2)},j=[],F=d(k,O,j,!1,null,"8b6a3c7b",null,null);const G=F.exports;export{G as default};
