!function(e,i){i.Activity=i.Activity||{},i.Activity.RichObjectStringParser={avatarsEnabled:!0,parseMessage:function(e,t){e=escapeHTML(e);var i=this,a=e.match(/\{([a-z\-_0-9]+)\}/gi);return _.each(a,(function(a){if(a=a.substring(1,a.length-1),t.hasOwnProperty(a)&&t[a]){var r=i.parseParameter(t[a]);e=e.replace("{"+a+"}",r)}else console.error("Potential malformed ROS string: parameter {"+a+"} was found in the string but is missing from the parameter list")})),e.replace(new RegExp("\n","g"),"<br>")},parseParameter:function(e){switch(e.type){case"file":return this.parseFileParameter(e).trim("\n");case"systemtag":var a=e.name;return"1"!==e.visibility?a=t("activity","{name} (invisible)",e):"1"!==e.assignable&&(a=t("activity","{name} (restricted)",e)),i.Activity.Templates.systemTag({name:a}).trim("\n");case"email":return i.Activity.Templates.email(e).trim("\n");case"open-graph":return i.Activity.Templates.openGraph(e).trim("\n");case"calendar-event":return i.Activity.Templates.calendarEvent(e).trim("\n");case"user":return _.isUndefined(e.server)?i.Activity.Templates.userLocal(e).trim("\n"):i.Activity.Templates.userRemote(e).trim("\n");default:return _.isUndefined(e.link)?i.Activity.Templates.unknown(e).trim("\n"):i.Activity.Templates.unkownLink(e).trim("\n")}},parseFileParameter:function(a){if(""===a.path)return i.Activity.Templates.fileRoot(_.extend(a,{homeTXT:t("activity","Home")}));var r=a.path.lastIndexOf("/"),n=a.path.indexOf("/");return a.path=a.path.substring(0===n?1:0,r),a.link||(a.link=e.generateUrl("/f/{fileId}",{fileId:a.id})),""===a.path||"/"===a.path?i.Activity.Templates.fileNoPath(a):i.Activity.Templates.file(_.extend(a,{title:0===a.path.length?"":t("activity","in {path}",a)}))}}}(OC,OCA);